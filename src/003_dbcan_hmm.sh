# first argument is the input faa file of concatenated proteins from all genomes
# second argument is argument is the output path
# third argument is the path to dbCAN.txt hmm database

infa=$1
outpath=$2
hmmdb_dir=$3
ncpu=$(lscpu | grep ^CPU\(s\) | grep -P -o "\\d+")
hdir=/dev/shm/dbcan_hmm

mkdir $hdir 
cp $hmmdb_dir/dbCAN.txt $hdir
cp $infa $hdir/prots.faa
hmmsearch \
        --cpu $ncpu \
        --domtblout $hdir/domtbl.txt \
        $hdir/dbCAN.txt \
        $hdir/prots.faa > /dev/null
mv $hdir/domtbl.txt $outpath
rm -rf $hdir
