# this script assumes all files to be concatenated are contained in a single
# directory
# 
# the first argument to this script is the genomic faa directory path. when
# downloading from NCBI, these will be the CDS_translated_from_genomic.faa files
# 
# the second argument is the output path, which will be the concatenated
# sequences of all proteins, with the header being the original file name from
# which the sequence came, followed by its number in that file

indir=$1
outpath=$2

# concatenate files into a single file
[ -f $outpath ] && rm $outpath
awk '{  bn=FILENAME; sub(/^.*\//,"",bn); 
        sub(".faa$","",bn); 
        hdr = ">" bn "_" FNR; 
        $1=""; gsub(/\n| *|/,"",$0); 
        print hdr "\n" $0}' \
 RS="\n>" \
 FS="\n" \
 OFS="\n" \
 $indir/*.faa >> $outpath
