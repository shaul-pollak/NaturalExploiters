rm(list=ls())
library(openxlsx)
library(svglite)
library(phytools)
library(ggplot2)
library(latex2exp)
library(RColorBrewer)
library(ggtree)
source("functions.R")
load("data/fig4.RData")

####
# plot
####

## type freq over time / final
tplt <- tidyr::pivot_longer(df.a,-1)
tplt <- tplt[grepl("^C2",tplt$name),]
tplt$time <- get_time(tplt$name)
tplt$rep <- get_rpt(tplt$name)
tplt$rep[tplt$time==0] <- 1
tplt$dilution <- get_dil(tplt$name)
tplt <- tplt[,-2]
tplt <- tplt[order(tplt$X,tplt$dilution,tplt$rep,tplt$time),]
tplt$value[tplt$value==0] <- NA
p <- ggplot(tplt[tplt$time>8,],aes(x=dilution,y=value,col=X)) + 
  geom_point(position=position_jitterdodge(jitter.width=.1)) +
  scale_y_log10(limits=c(.01,1)) +
  stat_summary(fun=median,geom="line") +
  stat_summary(fun=median,geom="point",size=3,shape=21,mapping=aes(fill=X),col="black") +
  scale_color_manual(values=adjustcolor(clr,alpha.f=.5)) +
  scale_fill_manual(values=clr) +
  theme_shaul(base_size=8) +
  labs(x="Dilution factor",y="Aggregate type frequency") +
  theme(aspect.ratio=1,legend.position="none")
ggsave("fig4d.svg",p,h=1.714,w=1.808,units="in")
##
