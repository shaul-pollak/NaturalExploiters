find_dominant <- function(toplot,clsf,j){
	o <- order(toplot[,j],decreasing=T)
	ns <- rownames(toplot)[o]
	data.frame(name=ns,class=clsf[ns,'class'],freq=toplot[ns,j])
}
plot_type <- function(df.a,time.point,et,exp.type,freq.thresh,clr,lgnd,pt){
	# find columns
	idx <- which(exp.type==et)
	rdf <- df.a[,(idx+1)]
	rtp <- time.point[idx]
	# plot first category
	sutp <- sort(unique(rtp))
	y <- unlist(rdf[1,])
	yl <- aggregate(y,by=list(rtp),mean)
	ind <- y>freq.thresh & is.finite(y)
	ind2 <- yl[,2]>freq.thresh & is.finite(yl[,2])
	plot(rtp[ind],log10(y[ind]),pch=pt,
	     col=adjustcolor(clr[df.a$X[1]],alpha.f=.3), xaxt="n",yaxt="n",
	     main=et,ylim=c(log10(freq.thresh),0),ylab="",xlab="")
	axis(1,lwd=3,pos=log10(freq.thresh))
	axis(2,lwd=3,las=1)
	lines(yl[ind2,1],log10(yl[ind2,2]),lwd=4,col=clr[df.a$X[1]],lty=pt)
	for(i in 2:nrow(df.a)){
		y <- unlist(rdf[i,])
		yl <- aggregate(y,by=list(rtp),mean)
		ind <- y>freq.thresh & is.finite(y)
		ind2 <- yl[,2]>freq.thresh & is.finite(yl[,2])
		points(rtp[ind],log10(y[ind]),pch=pt,
		       col=adjustcolor(clr[df.a$X[i]],alpha.f=.3),
		     xlab="",ylab="",main=et)
		lines(yl[ind2,1],log10(yl[ind2,2]),
		      lwd=4,col=clr[df.a$X[i]],lty=pt)
	}
	if(lgnd){
		legend(11.5,0,lty=1,lwd=2,col=clr,legend=names(clr),cex=1,
		       inset=c(-.9,-0),text.font=2,bg="gray90")
	}
}
